<!doctype html>
<html class="h-100" lang="en">
<head>
    <title>Contact Tracing Statistics Portal</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% load static %}

    <link rel="apple-touch-icon" sizes="180x180" href="{% static "apple-touch-icon.png" %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static "favicon-32x32.png" %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static "favicon-16x16.png" %}">
    <link rel="manifest" href="{% static "site.webmanifest" %}">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <style>
        .number-highlight {
            font-size: 1.5rem;
            text-decoration: underline;
            text-decoration-style: dotted;
        }

        .datapoints-list {
            list-style-type: none;
        }

        .tab-content {
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            border-bottom-left-radius: .25rem;
            border-bottom-right-radius: .25rem;
            padding: 10px;
            background-color: #fff;
        }

        .nav-tabs {
            margin-bottom: 0;
        }

        .tab-content > .active {
            background-color: #fff;
        }
    </style>
</head>
<body class="d-flex flex-column h-100">

<header>
    <!-- Fixed navbar -->
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Contact Tracing Statistics Portal</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                    aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto mb-2 mb-md-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Home</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            Other timeframes
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="/govt/timebased/7">Week</a></li>
                            <li><a class="dropdown-item" href="#">Others here</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Custom time??</a></li>
                        </ul>
                    </li>

                </ul>
                <form class="d-flex">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>
</header>

{% load govt_maths %}
<!-- Begin page content -->
<main class="flex-shrink-0">
    <div class="container" style="padding: 60px 15px 0">
        <h1 class="mt-5">Statistics for {{ time_description }}</h1>

        <div class="h-100 p-3 bg-light border rounded-3">
            <h2>Cases & Tests</h2>
            <p>In {{ time_description }}, there were:</p>
            <ul class="datapoints-list">
                <!-- TODO: make indicators real -->
                <li><span class="number-highlight">{{ num_pos }}</span> positive cases
                    <span data-bs-toggle="tooltip" data-bs-placement="right"
                          title="{% if num_pos >= prev_num_pos %}Increase{% else %}Decrease{% endif %} over {{ prev_time_description }}, from {{ prev_num_pos }} to {{ num_pos }}"
                          class="badge {% if num_pos >= prev_num_pos %}bg-danger{% else %}bg-success{% endif %} align-text-top">
                        {% if num_pos >= prev_num_pos %}▲{% else %}▼{% endif %}
                        {{ num_pos|sub:prev_num_pos }}
                    </span>
                    <div style="width:100%;">
                        <canvas id="pos_case_canvas"></canvas>
                    </div>
                </li>
                <li><span class="number-highlight">{{ num_tests }}</span> tests performed
                    <span data-bs-toggle="tooltip" data-bs-placement="right"
                          title="{% if num_tests >= prev_num_tests %}Increase{% else %}Decrease{% endif %} over  {{ prev_time_description }} from {{ prev_num_tests }} to {{ num_tests }}"
                          class="badge {% if num_tests >= prev_num_tests %}bg-success{% else %}bg-danger{% endif %} align-text-top">
                        {% if num_tests >= prev_num_tests %}▲{% else %}▼{% endif %}
                        {{ num_tests|sub:prev_num_tests }}
                    </span>
                    <div style="width:100%;">
                        <canvas id="num_tests_canvas"></canvas>
                    </div>
                </li>
                <li>a <span class="number-highlight">{{ pos_rate }}%</span> positivity rate
                    <span data-bs-toggle="tooltip" data-bs-placement="right"
                          title="{% if pos_rate >= prev_pos_rate %}Increase{% else %}Decrease{% endif %} over {{ prev_time_description }} from {{ prev_pos_rate }} to {{ pos_rate }}"
                          class="badge {% if pos_rate >= prev_pos_rate %}bg-danger{% else %}bg-success{% endif %} align-text-top">
                        {% if pos_rate >= prev_pos_rate %}▲{% else %}▼{% endif %}
                        {{ pos_rate|sub:prev_pos_rate }}%
                    </span>
                    <div style="width:100%;">
                        <canvas id="pos_rate_canvas"></canvas>
                    </div>
                </li>
            </ul>
            <p>Across different areas of the UK: </p>
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <button class="nav-link active" id="nav-country-tab" data-bs-toggle="tab"
                            data-bs-target="#nav-country"
                            type="button" role="tab" aria-controls="nav-country" aria-selected="true">Countries
                    </button>
                    <button class="nav-link" id="nav-region-tab" data-bs-toggle="tab" data-bs-target="#nav-region"
                            type="button" role="tab" aria-controls="nav-region" aria-selected="false">Regions
                    </button>
                    <button class="nav-link" id="nav-county-tab" data-bs-toggle="tab" data-bs-target="#nav-county"
                            type="button" role="tab" aria-controls="nav-county" aria-selected="false">Counties and
                        Unitary Authorities
                    </button>
                    <button class="nav-link" id="nav-la-tab" data-bs-toggle="tab" data-bs-target="#nav-la"
                            type="button" role="tab" aria-controls="nav-la" aria-selected="false">Local Authorities
                    </button>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-country" role="tabpanel"
                     aria-labelledby="nav-country-tab">
                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Country data or whatever</th>
                            <th scope="col">Last</th>
                            <th scope="col">Handle</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th scope="row">1</th>
                            <td>Mark</td>
                            <td>Otto</td>
                            <td>@mdo</td>
                        </tr>
                        <tr>
                            <th scope="row">2</th>
                            <td>Jacob</td>
                            <td>Thornton</td>
                            <td>@fat</td>
                        </tr>
                        <tr>
                            <th scope="row">3</th>
                            <td colspan="2">Larry the Bird</td>
                            <td>@twitter</td>
                        </tr>
                        </tbody>
                    </table>
                    <p>And a country map here</p>
                </div>
                <div class="tab-pane fade" id="nav-region" role="tabpanel" aria-labelledby="nav-region-tab">
                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Region data or whatever</th>
                            <th scope="col">Last</th>
                            <th scope="col">Handle</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th scope="row">1</th>
                            <td>Mark</td>
                            <td>Otto</td>
                            <td>@mdo</td>
                        </tr>
                        <tr>
                            <th scope="row">2</th>
                            <td>Jacob</td>
                            <td>Thornton</td>
                            <td>@fat</td>
                        </tr>
                        <tr>
                            <th scope="row">3</th>
                            <td colspan="2">Larry the Bird</td>
                            <td>@twitter</td>
                        </tr>
                        </tbody>
                    </table>
                    <p>And a region map here</p>
                </div>
                <div class="tab-pane fade" id="nav-county" role="tabpanel" aria-labelledby="nav-county-tab">
                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">County ^ Unitary AUthority data or whatever</th>
                            <th scope="col">Last</th>
                            <th scope="col">Handle</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th scope="row">1</th>
                            <td>Mark</td>
                            <td>Otto</td>
                            <td>@mdo</td>
                        </tr>
                        <tr>
                            <th scope="row">2</th>
                            <td>Jacob</td>
                            <td>Thornton</td>
                            <td>@fat</td>
                        </tr>
                        <tr>
                            <th scope="row">3</th>
                            <td colspan="2">Larry the Bird</td>
                            <td>@twitter</td>
                        </tr>
                        </tbody>
                    </table>
                    <p>And a county map here</p>
                </div>
                <div class="tab-pane fade" id="nav-la" role="tabpanel" aria-labelledby="nav-la-tab">
                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Local authority data or whatever</th>
                            <th scope="col">Last</th>
                            <th scope="col">Handle</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th scope="row">1</th>
                            <td>Mark</td>
                            <td>Otto</td>
                            <td>@mdo</td>
                        </tr>
                        <tr>
                            <th scope="row">2</th>
                            <td>Jacob</td>
                            <td>Thornton</td>
                            <td>@fat</td>
                        </tr>
                        <tr>
                            <th scope="row">3</th>
                            <td colspan="2">Larry the Bird</td>
                            <td>@twitter</td>
                        </tr>
                        </tbody>
                    </table>
                    <p>And a LA map here</p>
                </div>
            </div>
        </div>

        <div class="h-100 p-3 bg-light border rounded-3 mt-3 mb-3">
            <h2>Contacts & Tracing</h2>
            <p>In {{ time_description }}, </p>
            <ul class="datapoints-list">
                <!-- TODO: make indicators real -->
                <li><span class="number-highlight">{{ cases_contacted }}%</span> of positive cases were contacted by
                    tracers
                    <span data-bs-toggle="tooltip" data-bs-placement="right"
                          title="{% if cases_contacted >= prev_cases_contacted %}Increase{% else %}Decrease{% endif %} over {{ prev_time_description }}, from {{ prev_cases_contacted }} to {{ cases_contacted }}"
                          class="badge {% if cases_contacted >= prev_cases_contacted %}bg-success{% else %}bg-danger{% endif %} align-text-top">
                        {% if cases_contacted >= prev_cases_contacted %}▲{% else %}▼{% endif %}
                        {{cases_contacted|sub:prev_cases_contacted }}
                    </span>

                </li>
                <li><span class="number-highlight">{{ avg_contacts }}</span> was the average no. contacts per positive case
                    <span data-bs-toggle="tooltip" data-bs-placement="right"
                          title="{% if avg_contacts >= prev_avg_contacts %}Increase{% else %}Decrease{% endif %} over  {{ prev_time_description }} from {{ prev_avg_contacts }} to {{ avg_contacts }}"
                          class="badge {% if avg_contacts >= prev_avg_contacts %}bg-danger{% else %}bg-success{% endif %} align-text-top">
                        {% if avg_contacts >= prev_avg_contacts %}▲{% else %}▼{% endif %}
                        {{ avg_contacts|sub:prev_avg_contacts }}
                    </span>

                </li>
                <li><span class="number-highlight">{{ max_contacts }}</span> was the largest number of contacts per positive case
                    <span data-bs-toggle="tooltip" data-bs-placement="right"
                          title="{% if max_contacts >= prev_max_contacts %}Increase{% else %}Decrease{% endif %} over  {{ prev_time_description }} from {{ prev_max_contacts }} to {{ max_contacts }}"
                          class="badge {% if max_contacts >= prev_max_contacts %}bg-danger{% else %}bg-success{% endif %} align-text-top">
                        {% if max_contacts >= prev_max_contacts %}▲{% else %}▼{% endif %}
                        {{ max_contacts|sub:prev_max_contacts }}
                    </span>

                </li>

            </ul>
            <p>These contacts occurred in several clusters across the country, where a cluster is made up of at least {{ min_cases_in_cluster }} cases within {{ cluster_radius }}m of each other.</p>

           <div>Cluster map here</div>
        </div>

    </div>
</main>

<footer class="footer mt-auto py-3 bg-light">
    <div class="container">
        <span class="text-muted">TODO: Footer stuff here......</span>
    </div>
</footer>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
<script>
    // Add the tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });
</script>
<!-- Charting JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@1.26.0/build/global/luxon.min.js"
        integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@0.2.1"></script>
<script>
    let blue = 'rgb(54, 162, 235)';
    // will be removed when the actual data is plumbed in.
    let randomScalingFactor = function () {
        return Math.round(Math.random() * 200);
    };
    // setup data, settings for each chart
    const configs = {
        {% for _, chart_title, tag in charts_data %}
            "{{tag}}": {
                type: 'line',
                data: {
                    labels: [{% for day in days_range %} "{{ day.isoformat }}" , {% endfor %}],
                    datasets: [{
                        backgroundColor: blue, borderColor: blue,
                        data: [{% for day in days_range %} randomScalingFactor(), {% endfor %}],
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: '{{chart_title}} over {{ time_description }}'
                    },
                    legend: {display: false},
                    tooltips: {mode: 'index', intersect: false,},
                    hover: {mode: 'nearest', intersect: true},
                    scales: {
                        xAxes: [{display: true}], yAxes: [{display: true}]
                    }
                }
            },
        {% endfor %}
    };

    window.onload = function () {
        // Add all of the charts to the page
        for (let [key, value] of Object.entries(configs)) {
            const ctx = document.getElementById(key).getContext('2d');
            new Chart(ctx, value);
        }

    };


</script>

</body>
</html>
